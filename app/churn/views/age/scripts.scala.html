@(rs: (Array[(Int, Int, Double, Double, Int)],Array[(Int, Double, Double, Long)], Array[(String, Double, Double, Long)], String))
@import play.api.libs.json.Json
@import services.domain.CommonService
@import churn.utils.AgeGroupUtil

<script type="text/javascript">
        var width = '50%'
        var left = 'auto'
        var right = 'auto'
        if($(window).width() <= 600) {
            left = 110
            right = 0
            width = '70%'
        }
        else if($(window).width() > 600 && $(window).width() <= 800) {
                left = 'auto'
                right = 10
                width = '70%'
        }
        else if($(window).width() > 800 && $(window).width() <= 1024) {
                left = 'auto'
                right = 10
                width = '70%'
        }
        var options = {
                title: 'Churn Rate (%)',
                hAxis: {
                    title: 'Contract Age (month)',
                    gridlines: {
                        count: 13,
                        color: 'transparent'
                    },
                    maxAlternation: 2, // use a maximum of 1 line of labels
                    showTextEvery: 1, // show every label if possible
                    minTextSpacing: 40 // minimum spacing between adjacent labels, in pixels
                },
                vAxis: {
                    title: '',
                    gridlines: {
                        count: 9,
                        color: '#f0f0f0'
                    }
                },
                chartArea: {
                        height: "70%",
                        width: width,
                        left: left,
                        right: right
                },
                sizeAxis: {
                        maxSize: 25
                },
                colorAxis: {colors: ['#F6CECE', '#B40404']},
                bubble: {
                        textStyle: {
                                auraColor: 'none',
                        },
                        cursor: 'pointer',
                        opacity: 1
                },
                tooltip: {
                        trigger: 'none'
                }
        };
        google.load('visualization', '1.0', {
                'packages' : [ 'corechart' ]
        });
        google.setOnLoadCallback(drawChart);

        function drawChart() {
                $('.monthPicker').datepicker({
                        autoclose: true,
                        minViewMode: 1,
                        startDate: '-12m',
                        endDate: '-1m',
                        format: 'yyyy-mm'
                }).on('changeDate', function (selected) {
                        var startDate = new Date(selected.date.valueOf());
                        var yr = startDate.getFullYear();
                        var month = startDate.getMonth() < 9 ? ('0' + Number(startDate.getMonth() + 1)) : (Number(startDate.getMonth() + 1));
                        var newDate = yr + '-' + month;
                        $('#month').val(newDate)
                        // change highlight filters
                        $('.monthGrp').removeAttr('style')
                });
                // bubble charts
                var container = document.getElementById('container')
                var catesAge = @Html(Json.stringify(Json.toJson(AgeGroupUtil.AGE)))
                var internetChurnHuyDv = getDataChurn(@Html(Json.stringify(Json.toJson(rs._1))))
                var dataHuyDv = google.visualization.arrayToDataTable(internetChurnHuyDv)
                var chartHuyDv = new google.visualization.BubbleChart(container);
                google.visualization.events.addListener(chartHuyDv, 'ready', function () {
                        Array.prototype.forEach.call(container.getElementsByTagName('text'), function(text) {
                                if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444')) {
                                        if(text.innerHTML == 0 || text.innerHTML == 8)
                                            text.setAttribute('fill-opacity',0)
                                        text.innerHTML = "Vung "+text.innerHTML
                                }
                                // change label age
                                if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444')) {
                                        if(text.innerHTML == 0 || text.innerHTML == 72)
                                                text.setAttribute('fill-opacity',0)
                                        else{
                                                switch ( text.innerHTML){
                                                        case "6" :
                                                                text.innerHTML = "0-6";break;
                                                        case "12" :
                                                                text.innerHTML = "06-12";break;
                                                        case "18" :
                                                                text.innerHTML = "12-18";break;
                                                        case "24" :
                                                                text.innerHTML = "18-24";break;
                                                        case "30" :
                                                                text.innerHTML = "24-30";break;
                                                        case "36" :
                                                                text.innerHTML = "30-36";break;
                                                        case "42" :
                                                                text.innerHTML = "36-42";break;
                                                        case "48" :
                                                                text.innerHTML = "42-48";break;
                                                        case "54" :
                                                                text.innerHTML = "48-54";break;
                                                        case "60" :
                                                                text.innerHTML = "54-60";break;
                                                        case "66" :
                                                                text.innerHTML = ">60";break;
                                                }
                                        }
                                }
                        });
                });
                chartHuyDv.draw(dataHuyDv, options);
                google.visualization.events.addListener(chartHuyDv, 'select', function (e) {
                        var selection = chartHuyDv.getSelection();
                        if(selection.length >0) {
                                var row = selection[0].row;
                                var region = dataHuyDv.getValue(row, 2)
                                var age = dataHuyDv.getValue(row, 1)
                                Array.prototype.forEach.call(container.getElementsByTagName('text'), function(text) {
                                        if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404') && (text.innerHTML != "Vung 0") && (text.innerHTML != "Vung 8")) {
                                                if (text.innerHTML == "Vung "+region){
                                                        text.setAttribute('fill-opacity', 1)
                                                        text.setAttribute('fill', "#B40404")
                                                        text.setAttribute('font-weight', "bold")
                                                }
                                                else {
                                                        text.setAttribute('fill', "#444444")
                                                        text.setAttribute('fill-opacity', 0.5)
                                                        text.removeAttribute('font-weight')
                                                }
                                        }
                                        // change label age
                                        if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404')) {
                                                if (text.innerHTML != 0 && text.innerHTML != 72)
                                                        if(getNameByIdAge(Number(age)) == text.textContent){
                                                                text.setAttribute('fill-opacity', 1)
                                                                text.setAttribute('fill', "#B40404")
                                                                text.setAttribute('font-weight', "bold")
                                                        }
                                                        else {
                                                                text.setAttribute('fill', "#444444")
                                                                text.setAttribute('fill-opacity', 0.5)
                                                                text.removeAttribute('font-weight')
                                                        }
                                        }
                                })
                                $('#age').val(age)
                                $('#region').val(region)
                                $('.regionDiv').show()
                                $('.ageDiv').show()
                                $('.txtAge').text(getNameByIdAge(Number(age)))
                                $('.txtRegion').text(region)
                                $('.divStatus').attr('style','height:110px;padding-top: 15px')
                        }
                        else{
                                Array.prototype.forEach.call(container.getElementsByTagName('text'), function(text) {
                                        if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404') && (text.innerHTML != "Vung 0") && (text.innerHTML != "Vung 8")) {
                                                text.setAttribute('fill-opacity', 1)
                                                text.setAttribute('fill', "#444444")
                                                text.removeAttribute('font-weight')
                                        }
                                        if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404')) {
                                                if (text.innerHTML != 0 && text.innerHTML != 72){
                                                        text.setAttribute('fill-opacity', 1)
                                                        text.setAttribute('fill', "#444444")
                                                        text.removeAttribute('font-weight')
                                                }
                                        }
                                })
                                $('#age').val("")
                                $('#region').val("")
                                $('.regionDiv').hide()
                                $('.ageDiv').hide()
                                $('.txtAge').text("")
                                $('.txtRegion').text("")
                                $('.divStatus').attr('style','height:170px;padding-top: 15px')
                        }
                        ajaxGetChurn("regionAge")
                });
                var mouseX;
                var mouseY;
                $(document).mousemove(function(e) {
                    if($(window).width() < 992){
                            mouseX = e.pageX +115;
                            mouseY = -85
                    }
                    else if($(window).width() >= 992 && $(window).width() < 1024){
                            mouseX = e.pageX -125;
                            mouseY = -85
                    }
                    else{
                            mouseX = e.pageX +80;
                            mouseY = e.pageY -620;
                    }
                });

                function handlerOut() {
                        $('.custom_tooltip').hide();
                }
                // tam remove qua v2
                /*google.visualization.events.addListener(chartHuyDv, 'onmousedown', function (event) {
                        document.oncontextmenu = function() {
                                var age = dataHuyDv.getValue(Number(event.targetID.split('#')[2]), 1)
                                var region = dataHuyDv.getValue(Number(event.targetID.split('#')[2]), 2)
                                var ageGroup = getNameByIdAge(Number(age))
                                if(ageGroup == "06-12") ageGroup = "6-12"
                                window.location.href = "/churn/search?contract=Age:"+ageGroup+"_Region:"+region
                        };
                });*/
                google.visualization.events.addListener(chartHuyDv, 'onmouseover', function (event) {
                        var rate = dataHuyDv.getValue(event.row, 3);
                        var xAxis = dataHuyDv.getValue(event.row, 1);
                        var yAxis = dataHuyDv.getValue(event.row, 2);
                        var percent = dataHuyDv.getValue(event.row, 4);
                        var contracts = dataHuyDv.getValue(event.row, 5);
                        var x = mouseX - 225;
                        var y = mouseY ;
                        $('#churn_tooltip').html('<div><p><b>Age:</b> ' + keyByValue( catesAge, xAxis) +'</p><p><b>Region:</b> '+ yAxis +
                                '</p><p><b>Rate:</b> '+ rate +' %</p><p><b>Percent:</b> '+ percent +' %</p><p><b>Number of contracts: </b>'+Highcharts.numberFormat(Math.abs(contracts), 0)+'</p></div>').css({
                                'top': y,
                                'left': x
                        }).fadeIn('slow');
                });
                google.visualization.events.addListener(chartHuyDv, 'onmouseout', handlerOut);

                var churn_age = Highcharts.chart('churn1', {
                        chart: {
                                zoomType: 'xy'
                        },

                        title: {
                                text: ''
                        },

                        colors : ['#73879C','#dc5a78'],

                        xAxis: {
                                title: {text: 'Contract Age (month)'},
                                categories: @Html(Json.stringify(Json.toJson(rs._2.map(x=> AgeGroupUtil.getAgeById(x._1)))))
                        },

                        yAxis: [{ // Primary yAxis
                                /*max: rs._2.map(x=> x._3).max,
                                tickInterval:0.01,
                                min: rs._2.map(x=> x._3).min,*/
                                labels: {
                                        format: '{value} %',
                                        style: {
                                                color: "#73879C"
                                        }
                                },
                                title: {
                                        text: 'Churn Percent',
                                        style: {
                                                color: "#73879C"
                                        }
                                }
                        }, { // Secondary yAxis
                                title: {
                                        text: 'Churn Rate',
                                        style: {
                                                color: "#dc5a78"
                                        }
                                },
                                labels: {
                                        format: '{value} %',
                                        style: {
                                                color: "#dc5a78"
                                        }
                                },
                                opposite: true
                        }],

                        plotOptions: {
                                series: {
                                        cursor: 'pointer',
                                        point: {
                                                events: {
                                                        click: function () {
                                                                $('#region').val("")
                                                                $('.txtRegion').text("")
                                                                $('.regionDiv').hide()
                                                                if(getIdBynameAge(this.category) == $('#age').val()){
                                                                        for (var i = 0; i < this.series.data.length; i++) {
                                                                                this.series.data[i].update({ color: '#73879C' }, false, false)
                                                                        }
                                                                        $('#age').val("")
                                                                        $('.ageDiv').hide()
                                                                        $('.txtAge').text("")
                                                                        $('.divStatus').attr('style','height:170px;padding-top: 15px')
                                                                }
                                                                else{
                                                                        for (var i = 0; i < this.series.data.length; i++) {
                                                                                this.series.data[i].update({ color: '#ddd' }, false, false)
                                                                        }
                                                                        this.update({ color: '#73879C' });
                                                                        $('#age').val(getIdBynameAge(this.category))
                                                                        $('.ageDiv').show()
                                                                        $('.txtAge').text(this.category)
                                                                        $('.divStatus').attr('style','height:110px;padding-top: 15px')
                                                                }
                                                                ajaxGetChurn("age")
                                                        }
                                                        // tam remove qua v2
                                                        /*,
                                                        contextmenu: function () {
                                                                var ageGroup = this.category
                                                                if(ageGroup == "06-12") ageGroup = "6-12"
                                                                window.location.href = "/churn/search?contract=Age:"+ageGroup
                                                        }*/
                                                }
                                        }
                                }
                        },

                        tooltip: {
                                formatter: function() {
                                        var s = [];

                                        $.each(this.points, function(i, point) {
                                                if(point.series.name == 'Churn Percent'){
                                                        s.push('<span>'+ point.x +'</span><br>');
                                                        s.push('<br><span>Number of Contracts : <b>'+ Highcharts.numberFormat(Math.abs(point.point.k), 0) +'</b><span>');
                                                }
                                                if(point.series.name == "Churn Rate"){
                                                        s.push('<span style="color: #dc5a78">'+ point.series.name +' : <b>'+ point.y +' %</b><span>');
                                                }
                                                else {
                                                        s.push('<span style="color: #73879C">'+ point.series.name +' : <b>'+ point.y +' %</b><span>');
                                                }
                                        });

                                        return s.join(' <br> ');
                                },
                                shared: true
                        },


                        series: getJsonChurnMonth(@Html(Json.stringify(Json.toJson(rs._2.map(x=> x._2)))),@Html(Json.stringify(Json.toJson(rs._2.map(x=> (x._3, x._4))))))

                });

                var churn_month = Highcharts.chart('churn2', {
                        chart: {
                                zoomType: 'xy'
                        },

                        title: {
                                text: ''
                        },
                        colors : ['#149c7f','#dc5a78'],

                        xAxis: {
                            categories: @Html(Json.stringify(Json.toJson(rs._3.map(x=>x._1)))),
                            labels: {
                                useHTML: true,//set to true
                                style: {
                                    fontSize: '10px'
                                }
                            }
                        },

                        yAxis: [{ // Primary yAxis
                                labels: {
                                        format: '{value} %',
                                        style: {
                                                color: "#149c7f"
                                        }
                                },
                                title: {
                                        text: 'Churn Percent',
                                        style: {
                                                color: "#149c7f"
                                        }
                                }
                        }, { // Secondary yAxis
                                title: {
                                        text: 'Churn Rate',
                                        style: {
                                                color: "#dc5a78"
                                        }
                                },
                                labels: {
                                        format: '{value} %',
                                        style: {
                                                color: "#dc5a78"
                                        }
                                },
                                opposite: true
                        }],
                        // tam remove qua v2
                        /*plotOptions: {
                                series: {
                                        cursor: 'pointer',
                                        point: {
                                                events: {
                                                        contextmenu: function () {
                                                                window.location.href = "/churn/search?contract=Month:"+this.category
                                                        }
                                                }
                                        }
                                }
                        },*/

                        tooltip: {
                                formatter: function() {
                                        var s = [];

                                        $.each(this.points, function(i, point) {
                                                if(point.series.name == 'Churn Percent'){
                                                        s.push('<span>'+ point.x +'</span><br>');
                                                        s.push('<br><span>Number of Contracts : <b>'+ Highcharts.numberFormat(Math.abs(point.point.k), 0) +'</b><span>');
                                                }
                                                s.push('<span>'+ point.series.name +' : <b>'+ point.y +'</b><span>');
                                        });

                                        return s.join(' <br> ');
                                },
                                shared: true
                        },

                        series: getJsonChurnMonth(@Html(Json.stringify(Json.toJson(rs._3.map(x=> x._2)))),@Html(Json.stringify(Json.toJson(rs._3.map(x=> x._3 -> x._4)))))

                });

                // click apply fitler
                $('.apply').click(function () {
                      $('#region').val("")
                      $('#age').val("")
                      $('.txtRegion').text("")
                      $('.txtAge').text("")
                      $('.regionDiv').hide()
                      $('.ageDiv').hide()
                      $('.divStatus').attr('style','height:170px;padding-top: 15px')
                      ajaxGetChurn("*")
                })
                // onchange status selectbox
                $('.slStatus').on('change', function () {
                        $('#status').val($(this).val())
                        // remove highlight filters
                        $('.slStatus').removeAttr('style')
                })

                function ajaxGetChurn(_type){
                        var fields = getParamFields(document.querySelector('input[name=csrfToken]').value)
                        $.ajax({
                                url: "/internet/age/getJsonChurn",
                                cache: false,
                                data:  fields,
                                type:"POST",
                                beforeSend: function () {
                                        $('.divLeft').waitMe({
                                                effect: 'progressBar',
                                                text: 'Please wait...',
                                                bg: 'rgba(255,255,255,0.7)',
                                                color: '#000',
                                                textPos: 'vertical'
                                        });
                                },
                                success: function (dta) {
                                        if(dta != "Error"){
                                            // change highlight filters
                                            $('.slStatus').attr('style','border:1px solid #16a085!important')
                                            $('.monthGrp').attr('style','background-color: #16a085!important;color: #fff')
                                            $('#monthAge').text($('#month').val())
                                            $('#monthRegion').text($('#month').val())
                                            // update chart Age
                                            if(_type != "age") {
                                                updateCharts(churn_age, getJsonChurnMonth(dta.churnAge.churnRate, dta.churnAge.churnPercent))
                                            }
                                            else{
                                                if($("#age").val() == "") churn_age.series[0].update({color: '#73879C'})
                                            }
                                            // update chart Month
                                            updateCharts(churn_month, getJsonChurnMonth(dta.churnMonth.churnRate, dta.churnMonth.churnPercent))
                                            // update chart bubble
                                            if(_type != "regionAge") {
                                                    $('#txtMin').text(dta.churnRegionAge.minPercent)
                                                    $('#txtMax').text(dta.churnRegionAge.maxPercent)
                                                    $('#circle2').text(Number(dta.churnRegionAge.minPercent + (dta.churnRegionAge.maxPercent-dta.churnRegionAge.minPercent)/5*2).toFixed(2))
                                                    $('#circle3').text(Number(dta.churnRegionAge.minPercent + (dta.churnRegionAge.maxPercent-dta.churnRegionAge.minPercent)/5*3).toFixed(2))
                                                    var churnStatus = getDataChurn(dta.churnRegionAge.data)
                                                    var dataStatus = google.visualization.arrayToDataTable(churnStatus)
                                                    var chartStatus = new google.visualization.BubbleChart(document.getElementById('container'));
                                                    google.visualization.events.addListener(chartStatus, 'ready', function () {
                                                            Array.prototype.forEach.call(document.getElementById('container').getElementsByTagName('text'), function(text) {
                                                                    if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444')) {
                                                                            if(text.innerHTML == 0 || text.innerHTML == 8)
                                                                                    text.setAttribute('fill-opacity',0)
                                                                            text.innerHTML = "Vung "+text.innerHTML
                                                                    }
                                                                    // change label age
                                                                    if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444')) {
                                                                            if(text.innerHTML == 0 || text.innerHTML == 72)
                                                                                    text.setAttribute('fill-opacity',0)
                                                                            else{
                                                                                    switch ( text.innerHTML){
                                                                                            case "6" :
                                                                                                    text.innerHTML = "0-6";break;
                                                                                            case "12" :
                                                                                                    text.innerHTML = "06-12";break;
                                                                                            case "18" :
                                                                                                    text.innerHTML = "12-18";break;
                                                                                            case "24" :
                                                                                                    text.innerHTML = "18-24";break;
                                                                                            case "30" :
                                                                                                    text.innerHTML = "24-30";break;
                                                                                            case "36" :
                                                                                                    text.innerHTML = "30-36";break;
                                                                                            case "42" :
                                                                                                    text.innerHTML = "36-42";break;
                                                                                            case "48" :
                                                                                                    text.innerHTML = "42-48";break;
                                                                                            case "54" :
                                                                                                    text.innerHTML = "48-54";break;
                                                                                            case "60" :
                                                                                                    text.innerHTML = "54-60";break;
                                                                                            case "66" :
                                                                                                    text.innerHTML = ">60";break;
                                                                                    }
                                                                            }
                                                                    }
                                                            });
                                                    });
                                                    chartStatus.draw(dataStatus, options);
                                                    google.visualization.events.addListener(chartStatus, 'select', function () {
                                                            var selection = chartStatus.getSelection();
                                                            if(selection.length >0) {
                                                                    var row = selection[0].row;
                                                                    var region = dataStatus.getValue(row, 2)
                                                                    var age = dataStatus.getValue(row, 1)
                                                                    Array.prototype.forEach.call(container.getElementsByTagName('text'), function(text) {
                                                                            if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404') && (text.innerHTML != "Vung 0") && (text.innerHTML != "Vung 8")) {
                                                                                    if (text.innerHTML == "Vung "+region){
                                                                                            text.setAttribute('fill-opacity', 1)
                                                                                            text.setAttribute('fill', "#B40404")
                                                                                            text.setAttribute('font-weight', "bold")
                                                                                    }
                                                                                    else {
                                                                                            text.setAttribute('fill', "#444444")
                                                                                            text.setAttribute('fill-opacity', 0.5)
                                                                                            text.removeAttribute('font-weight')
                                                                                    }
                                                                            }
                                                                            // change label age
                                                                            if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404')) {
                                                                                    if (text.innerHTML != 0 && text.innerHTML != 72)
                                                                                            if(getNameByIdAge(Number(age)) == text.textContent){
                                                                                                    text.setAttribute('fill-opacity', 1)
                                                                                                    text.setAttribute('fill', "#B40404")
                                                                                                    text.setAttribute('font-weight', "bold")
                                                                                            }
                                                                                            else {
                                                                                                    text.setAttribute('fill', "#444444")
                                                                                                    text.setAttribute('fill-opacity', 0.5)
                                                                                                    text.removeAttribute('font-weight')
                                                                                            }
                                                                            }
                                                                    })
                                                                    $('#age').val(age)
                                                                    $('#region').val(region)
                                                                    $('.regionDiv').show()
                                                                    $('.ageDiv').show()
                                                                    $('.txtAge').text(getNameByIdAge(Number(age)))
                                                                    $('.txtRegion').text(region)
                                                                    $('.divStatus').attr('style','height:110px;padding-top: 15px')
                                                            }
                                                            else{
                                                                    Array.prototype.forEach.call(container.getElementsByTagName('text'), function(text) {
                                                                            if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404') && (text.innerHTML != "Vung 0") && (text.innerHTML != "Vung 8")) {
                                                                                    text.setAttribute('fill-opacity', 1)
                                                                                    text.setAttribute('fill', "#444444")
                                                                                    text.removeAttribute('font-weight')
                                                                            }
                                                                            if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#444444' || text.getAttribute('fill') === '#B40404')) {
                                                                                    if (text.innerHTML != 0 && text.innerHTML != 72){
                                                                                            text.setAttribute('fill-opacity', 1)
                                                                                            text.setAttribute('fill', "#444444")
                                                                                            text.removeAttribute('font-weight')
                                                                                    }
                                                                            }
                                                                    })
                                                                    $('#age').val("")
                                                                    $('#region').val("")
                                                                    $('.regionDiv').hide()
                                                                    $('.ageDiv').hide()
                                                                    $('.txtAge').text("")
                                                                    $('.txtRegion').text("")
                                                                    $('.divStatus').attr('style','height:170px;padding-top: 15px')
                                                            }
                                                            ajaxGetChurn("regionAge")
                                                    });
                                                    // tam remove qua v2
                                                    /*google.visualization.events.addListener(chartStatus, 'onmousedown', function (event) {
                                                            document.oncontextmenu = function() {
                                                                    var age = dataStatus.getValue(Number(event.targetID.split('#')[2]), 1)
                                                                    var region = dataStatus.getValue(Number(event.targetID.split('#')[2]), 2)
                                                                    var ageGroup = getNameByIdAge(Number(age))
                                                                    if(ageGroup == "06-12") ageGroup = "6-12"
                                                                    window.location.href = "/churn/search?contract=Age:"+ageGroup+"_Region:"+region
                                                            };
                                                    });*/
                                                    google.visualization.events.addListener(chartStatus, 'onmouseover', function (event) {
                                                            var rate = dataStatus.getValue(event.row, 3);
                                                            var xAxis = dataStatus.getValue(event.row, 1);
                                                            var yAxis = dataStatus.getValue(event.row, 2);
                                                            var percent = dataStatus.getValue(event.row, 4);
                                                            var contracts = dataStatus.getValue(event.row, 5);
                                                            var x = mouseX - 225;
                                                            var y = mouseY ;
                                                            $('#churn_tooltip').html('<div><p><b>Age:</b> ' + keyByValue( catesAge, xAxis) +'</p><p><b>Region:</b> '+ yAxis +
                                                                    '</p><p><b>Rate:</b> '+ rate +' %</p><p><b>Percent:</b> '+ percent +' %</p><p><b>Number of contracts: </b>'+Highcharts.numberFormat(Math.abs(contracts), 0)+'</p></div>').css({
                                                                    'top': y,
                                                                    'left': x
                                                            }).fadeIn('slow');
                                                    });
                                                    google.visualization.events.addListener(chartStatus, 'onmouseout', handlerOut);
                                            }
                                        }
                                        else{
                                                alert("Error when execute query. Please check again your system!")
                                        }
                                },
                                complete: function () {
                                        $('.divLeft').waitMe("hide");
                                }
                        });
                }
        }

        function getParamFields(token){
                var obj = {
                        "csrfToken" : token,
                        "region" : $('#region').val(),
                        "age"    : $('#age').val(),
                        "month"  : $('#month').val(),
                        "status" : $('#status').val()
                }
                //console.log(obj)
                return obj
        }

        function getDataChurn(dta){
            var rs = []
            rs.push(['ID', 'Age', 'Region','Rate', 'Percent','Contract'])
            for(var i=0;i<dta.length;i++){
                var arr = []
                    arr[0]=''
                    arr[1]=dta[i][1]
                    arr[2]=dta[i][0]
                    arr[3]=dta[i][2]
                    arr[4]=dta[i][3]
                    arr[5]=dta[i][4]
                rs.push(arr)
            }
            return rs
        }

</script>