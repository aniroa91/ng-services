@(rs: churn.models.OverviewResponse, arrayMonth: Array[String])
@import play.api.libs.json.Json
@import services.domain.CommonService

<script type="text/javascript">
        var optionsRegion = {
            title: 'Churn Rate (%)',
            hAxis: {
                title: '',
                gridlines: {
                    count: 14,
                    color: 'transparent'
                },
                viewWindow: {
                    min:0
                },
                textStyle : {
                    color:'#1c2752',
                    fontSize: 11
                },
            },
            vAxis: {
                title: '',
                gridlines: {
                    count: @rs.trendRegionMonth._1.size+2,
                    color: '#f0f0f0'
                }
            },
            chartArea: {
                height: "74%",
                width: "73%",
                left: 150,
                right: 20
            },
            width: '100%',
            height: '100%',
            sizeAxis: {
                maxSize: 20
            },
            colorAxis: {colors: ['#F6CECE', '#B40404']},
            bubble: {
                textStyle: {
                    auraColor: 'none',
                },
                cursor: 'pointer',
                opacity: 1
            },
            tooltip: {
                trigger: 'none'
            }
        };
        google.load('visualization', '1.0', {
            'packages' : [ 'corechart' ]
        });
        google.setOnLoadCallback(drawChart);

        function drawChart() {
            $('.inlinesparkline').sparkline('html',{
                type: 'line',
                width: '320px',
                height: '15px',
                lineColor: '#16a085',
                fillColor: '#ffffff',
                lineWidth: 1,
                spotColor: '#e21212',
                minSpotColor: '#132186',
                maxSpotColor: '#132186',
                highlightLineColor: '#ffffff',
                valueSpots:{'0:':'#e21212'},
                tooltipFormat: '{{offset:names}}: <b>{{y:value}}</b>',
                tooltipValueLookups: {
                    names: @Html(Json.stringify(Json.toJson(arrayMonth)))
                }
            });
            $(".slAge").select2({
                placeholder: "Choose age group ..."
            });
            $(".slPackage").select2({
                placeholder: "Choose package ..."
            });
            $('.radio').iCheck({
                radioClass: 'iradio_square-purple'
            });
            $('.checkbox').iCheck({
                checkboxClass: 'icheckbox_square-purple'
            });
            $('.monthPicker').datepicker({
                autoclose: true,
                minViewMode: 1,
                endDate: '-1m',
                format: 'yyyy-mm'
            }).on('changeDate', function (selected) {
                var startDate = new Date(selected.date.valueOf());
                var yr = startDate.getFullYear();
                var month = startDate.getMonth() < 9 ? ('0' + Number(startDate.getMonth() + 1)) : (Number(startDate.getMonth() + 1));
                var newDate = yr + '-' + month;
                $('#month').val(newDate)
                // change highlight filters
                $('.monthGrp').removeAttr('style')
            });
            // jsTree Region and province
            $('.region').jstree({
                "plugins" : ["checkbox"],
                'checkbox': {
                    deselect_all: true,
                    three_state: false
                },
                'core' : {
                    multiple: false,
                    expand_selected_onload : false,
                    "themes":{
                        "icons":false
                    },
                    'data' : getJsonTreeListRegion(@Html(Json.stringify(Json.toJson(rs.province))),@Html(Json.stringify(Json.toJson( rs.province.map(x => x._1).distinct.sorted ))))
                }
            }).on('changed.jstree', function (e, data) {
                var i, j, nodes = [], provinces = [];
                for (i = 0, j = data.selected.length; i < j; i++) {
                    nodes.push(data.instance.get_node(data.selected[i]).id);
                }
                var regionArr = nodes.join(', ').split(',')
                for (var i = 0; i < regionArr.length; i++) {
                    provinces.push(regionArr[i])
                }
                $('#province').val(provinces)
            })

            // trend region and month charts bubble
            var containerBuble   = document.getElementById('bubleChurn')
            var catesMonth   = @Html(Json.stringify(Json.toJson(rs.trendRegionMonth._2)))
            var catesLocation = @Html(Json.stringify(Json.toJson(rs.trendRegionMonth._1)))

            var internetChurnHuyDv = getDataChurn(@Html(Json.stringify(Json.toJson(rs.trendRegionMonth._3))), "Month", "Location")
            var dataHuyDv = google.visualization.arrayToDataTable(internetChurnHuyDv)
            var chartHuyDv = new google.visualization.BubbleChart(containerBuble);
            google.visualization.events.addListener(chartHuyDv, 'ready', function () {
                Array.prototype.forEach.call(containerBuble.getElementsByTagName('text'), function(text) {
                    if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444')) {
                        if(text.innerHTML == 0 || text.innerHTML == Object.keys(catesLocation).length+1)
                            text.setAttribute('fill-opacity',0)
                        else{
                            text.innerHTML = keyByValue(catesLocation, Number(text.innerHTML)) ;
                        }
                    }
                    // change label month
                    if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#1c2752')) {
                        if(text.innerHTML == 0 || text.innerHTML == Object.keys(catesMonth).length + 1)
                            text.setAttribute('fill-opacity',0)
                        else{
                            text.innerHTML = keyByValue(catesMonth, Number(text.innerHTML))
                        }
                    }
                });
                // remove circle value =0
                Array.prototype.forEach.call(document.getElementById('bubleChurn').getElementsByTagName('circle'), function(circle) {
                    if(circle.getAttribute('r') == 5 && $('#minRatemonthRegion').val() == 0 && $('#minPertmonthRegion').val() == 0)
                        circle.setAttribute('r', 1)
                })
            });
            if(Object.keys(catesMonth).length == 1)
                optionsRegion.hAxis.gridlines.count = 4
            else
                optionsRegion.hAxis.gridlines.count = Object.keys(catesMonth).length+2
            chartHuyDv.draw(dataHuyDv, optionsRegion);
            var mouseX;
            var mouseY;
            $(document).mousemove(function(e) {
                if($(window).width() < 992){
                    mouseY = e.pageY - 790
                }
                else{
                    mouseY = e.pageY -490;
                }
            });

            function handlerOut() {
                $('.custom_tooltip').hide()
            }

            google.visualization.events.addListener(chartHuyDv, 'onmouseover', function (event) {
                var rate = dataHuyDv.getValue(event.row, 3);
                var xAxis = dataHuyDv.getValue(event.row, 1);
                var yAxis = dataHuyDv.getValue(event.row, 2);
                var percent = dataHuyDv.getValue(event.row, 4);
                var contracts = dataHuyDv.getValue(event.row, 5);
                var x = mouseX - 225;
                if($(window).width() < 992){
                    mouseY = mouseY - 870
                }
                else{
                    mouseY = mouseY -600
                }
                var y = mouseY
                if(!(Number(percent == 0) && Number(rate) == 0)){
                    $('#bubleChurn_tooltip').html('<div><p><b>Month:</b> ' + keyByValue(catesMonth, xAxis) +'</p><p><b>Location:</b> '+ keyByValue( catesLocation, yAxis) +
                            '</p><p><b>Rate:</b> '+ rate +' %</p><p><b>Percent:</b> '+ percent +' %</p><p><b>Number of contracts: </b>'+contracts+'</p></div>').css({
                        'top': y,
                        'left': x
                    }).fadeIn('slow');
                }
                // remove circle value =0
                Array.prototype.forEach.call(document.getElementById('bubleChurn').getElementsByTagName('circle'), function(circle) {
                    if($('#minRatemonthProf').val() == 0 && $('#minPertmonthProf').val() == 0 && (circle.getAttribute('fill') == 'none' || circle.getAttribute('r') == 5)){
                        circle.setAttribute('r', 1)
                    }
                })
            });
            google.visualization.events.addListener(chartHuyDv, 'onmouseout', handlerOut);

            var track1 = Highcharts.chart('track1', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: ''
                },
                xAxis: {
                    categories: @Html(Json.stringify(Json.toJson(rs.numofMonth.map(x=> x._1).distinct.sorted)))
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    stackLabels: {
                        enabled: true,
                        style: {
                            fontWeight: 'bold'
                        }
                    }
                },
                plotOptions: {
                    column: {
                        stacking: 'normal'
                    }
                },
                colors : ['#fe7096','#3498DB'],
                tooltip: {
                    shared: true
                },
                series: [{
                    name: 'HSSD',
                    data: @Html(Json.stringify(Json.toJson(rs.numofMonth.filter(x=> x._2.toInt == 1).sorted.map(x=> x._3))))
                }, {
                    name: 'CTBDV',
                    data: @Html(Json.stringify(Json.toJson(rs.numofMonth.filter(x=> x._2.toInt == 3).sorted.map(x=> x._3))))
                }]
            });

            var track2 = Highcharts.chart('track2', {
                chart: {
                    zoomType: 'xy'
                },

                title: {
                    text: ''
                },

                colors : ['rgb(126,223,114)', '#73879C', 'rgb(255,122,86)'],

                xAxis: {
                    categories: @Html(Json.stringify(Json.toJson(rs.trendRatePert.map(x=> x._1).distinct.sorted)))
                },

                yAxis: [{
                    labels: {
                        format: '{value}',
                        style: {
                            color: "rgb(255,122,86)"
                        }
                    },
                    title: {
                        text: 'Churn Rate(%) & F1',
                        style: {
                            color: "rgb(255,122,86)"
                        }
                    }
                }, { // Secondary yAxis
                    max: 100,
                    min: 0,
                    title: {
                        text: 'Churn Percent',
                        style: {
                            color: "#73879C"
                        }
                    },
                    labels: {
                        format: '{value} %',
                        style: {
                            color: "#73879C"
                        }
                    },
                    opposite: true
                }],

                tooltip: {
                    shared: true
                },

                series: [{
                    type: 'column',
                    name: 'Churn Rate(%)',
                    yAxis: 0,
                    data: @Html(Json.stringify(Json.toJson(rs.trendRatePert.map(x=> x._2))))
                }, {
                    type: 'column',
                    name: 'Churn Percent(%)',
                    yAxis: 1,
                    data: @Html(Json.stringify(Json.toJson(rs.trendRatePert.map(x=> x._3))))
                }, {
                    type: 'spline',
                    name: 'F1',
                    yAxis: 0,
                    data: @Html(Json.stringify(Json.toJson(rs.trendRatePert.map(x=> x._4))))
                }]

            });

            // click tooltip title
            var specifiedElement = document.getElementsByClassName('aMore');
            document.addEventListener('click', function(event) {
                var isClickInside = specifiedElement[Number($('#indexChart').val())].contains(event.target)
                if(!isClickInside && String(event.target.className).indexOf('tooltipSL')<0){
                    $('.ddMore').hide()
                    $('.dots').show()
                    $('.more').hide()
                    $('.tooltipSL').removeClass('fa-angle-double-up').addClass('fa-angle-double-down')
                }
            });

            // click refresh fitler
            $('.btnRefresh').click(function () {
                $('.slAge').val('').trigger('change')
                $('.slPackage').val('').trigger('change')
                $('.radio').removeAttr('checked').iCheck('update')
                $('.checkbox').removeAttr('checked').iCheck('update')
                $(".monthPicker").datepicker("update", $('#monthCurr').val())
                $(".region").jstree("deselect_all")
                $('#combo').val("")
                getAjaxChurn()
            })

            function getAjaxChurn() {
                var fields = getParamFields(document.querySelector('input[name=csrfToken]').value)
                $.ajax({
                    url: "/internet/overview/getJsonChurn",
                    cache: false,
                    data:  fields,
                    type:"POST",
                    beforeSend: function () {
                        $('.divLeft').waitMe({
                            effect: 'progressBar',
                            text: 'Please wait...',
                            bg: 'rgba(255,255,255,0.7)',
                            color: '#000',
                            textPos: 'vertical'
                        });
                    },
                    success: function (dta) {
                        if(dta != "Error"){
                            /* update box number */
                            // box Active Contract
                            $('#boxCtActive .currCtActive').text(dta.numContract.actives.curr)
                            var prevCtActive = '<h4>'+dta.numContract.actives.prev+' <i class="fa fa-info-circle iconTip" title="Tổng số hợp đồng tháng cùng kỳ năm ngoái"></i></h4>';
                            prevCtActive += (Number(dta.numContract.actives.prev.replace(",","")) > Number(dta.numContract.actives.curr.replace(",","")))? '<span class="down"><i class="fa fa-arrow-down fadeInDown animated" aria-hidden="true"></i> ' : '<span class="up"><i class="fa fa-arrow-up fadeInUp animated" aria-hidden="true"></i> '
                            prevCtActive += dta.numContract.actives.perct+' % </span> from '+dta.lastYYYYmm
                            $('#boxCtActive .prevCtActive').html("").append(prevCtActive)
                            if(dta.numContract.actives.curr == "0" && dta.numContract.actives.prev == "0") $('#boxCtActive').attr('style','opacity:0.2')
                            else $('#boxCtActive').removeAttr('style')

                            // box HUYDV Contract
                            $('#boxCtHuydv .currCtHuydv').text(dta.numContract.huydv.curr)
                            var prevCthuydv = '<h4>'+dta.numContract.huydv.prev+' <i class="fa fa-info-circle iconTip" title="Tổng số hợp đồng HSSD cùng kỳ năm ngoái"></i></h4>';
                            prevCthuydv += (Number(dta.numContract.huydv.prev.replace(",","")) > Number(dta.numContract.huydv.curr.replace(",",""))) ? '<span class="down"><i class="fa fa-arrow-down fadeInDown animated" aria-hidden="true"></i> ' : '<span class="up"><i class="fa fa-arrow-up fadeInUp animated" aria-hidden="true"></i> '
                            prevCthuydv += dta.numContract.huydv.perct+' % </span> from '+dta.lastYYYY
                            $('#boxCtHuydv .prevCtHuydv').html("").append(prevCthuydv)
                            if(dta.numContract.huydv.curr == "0" && dta.numContract.huydv.prev == "0") $('#boxCtHuydv').attr('style','opacity:0.2')
                            else $('#boxCtHuydv').removeAttr('style')

                            // box CTBDV Contract
                            $('#boxCtCtbdv .currCtCtbdv').text(dta.numContract.ctbdv.curr)
                            var prevCtCtbdv = '<h4>'+dta.numContract.ctbdv.prev+' <i class="fa fa-info-circle iconTip" title="Tổng số hợp đồng CTBDV cùng kỳ năm ngoái"></i></h4>';
                            prevCtCtbdv += (Number(dta.numContract.ctbdv.prev.replace(",","")) > Number(dta.numContract.ctbdv.curr.replace(",","")))? '<span class="down"><i class="fa fa-arrow-down fadeInDown animated" aria-hidden="true"></i> ' : '<span class="up"><i class="fa fa-arrow-up fadeInUp animated" aria-hidden="true"></i> '
                            prevCtCtbdv += dta.numContract.ctbdv.perct+' % </span> from '+dta.lastYYYY
                            $('#boxCtCtbdv .prevCtCtbdv').html("").append(prevCtCtbdv)
                            if(dta.numContract.ctbdv.curr == "0" && dta.numContract.ctbdv.prev == "0") $('#boxCtCtbdv').attr('style','opacity:0.2')
                            else $('#boxCtCtbdv').removeAttr('style')

                            // box Total Churn Rate
                            $('.currMonth').text($('.monthGrp').val())
                            $('#boxRateTotal .avgRateTotal').text(dta.churnRate.totalRate.avg)
                            $('#boxRateTotal .currRateTotal').html(dta.churnRate.totalRate.curr+' % <i class="fa fa-info-circle iconTip" title="Tỷ lệ rời mạng, bao gồm HSSD và CTBDV, của tháng hiện tại"></i>')
                            if(dta.churnRate.totalRate.curr == 0 && dta.churnRate.totalRate.avg == 0) $('#boxRateTotal').attr('style','opacity:0.2')
                            else $('#boxRateTotal').removeAttr('style')

                            // box HUYDV Churn Rate
                            $('#boxRateHuydv .avgRateHuydv').text(dta.churnRate.huydvRate.avg)
                            $('#boxRateHuydv .currRateHuydv').html(dta.churnRate.huydvRate.curr+' % <i class="fa fa-info-circle iconTip" title="Tỷ lệ rời mạng, tính theo HSSD, của tháng hiện tại"></i>')
                            if(dta.churnRate.huydvRate.curr == 0 && dta.churnRate.huydvRate.avg == 0) $('#boxRateHuydv').attr('style','opacity:0.2')
                            else $('#boxRateHuydv').removeAttr('style')

                            // box CTBDV Churn Rate
                            $('#boxRateCtbdv .avgRateCtbdv').text(dta.churnRate.ctbdvRate.avg)
                            $('#boxRateCtbdv .currRateCtbdv').html(dta.churnRate.ctbdvRate.curr+ ' % <i class="fa fa-info-circle iconTip" title="Tỷ lệ rời mạng, tính theo CTBDV, của tháng hiện tại"></i>')
                            if(dta.churnRate.ctbdvRate.curr == 0 && dta.churnRate.ctbdvRate.avg == 0) $('#boxRateCtbdv').attr('style','opacity:0.2')
                            else $('#boxRateCtbdv').removeAttr('style')

                            // sparkline table
                            var tBody = parseTbChurnRate(dta.tbChurn)
                            $('#tbChurn tbody').html("").append(tBody)
                            $('.inlinesparkline').sparkline('html',{
                                type: 'line',
                                width: '320px',
                                height: '15px',
                                lineColor: '#16a085',
                                fillColor: '#ffffff',
                                lineWidth: 1,
                                spotColor: '#e21212',
                                minSpotColor: '#132186',
                                maxSpotColor: '#132186',
                                highlightLineColor: '#ffffff',
                                valueSpots:{'0:':'#e21212'},
                                tooltipFormat: '{{offset:names}}: <b>{{y:value}}</b>',
                                tooltipValueLookups: {
                                    names: dta.tbChurn.arrMonth
                                }
                            });
                            $('.thFirst').text(dta.location)
                            // bubble charts
                            if(dta.churnBubble.data.length <= 0){
                                $('#buble_overlay').hide()
                                $('#bubleChurn').hide()
                            }
                            else{
                                $('#buble_overlay').show()
                                $('#bubleChurn').show()
                            }
                            $('#churn3_txtMin').text(dta.churnBubble.minPercent)
                            $('#churn3_txtMax').text(dta.churnBubble.maxPercent)
                            $('#churn3_circle2').text(Number(dta.churnBubble.minPercent + (dta.churnBubble.maxPercent-dta.churnBubble.minPercent)/5*2).toFixed(2))
                            $('#churn3_circle3').text(Number(dta.churnBubble.minPercent + (dta.churnBubble.maxPercent-dta.churnBubble.minPercent)/5*3).toFixed(2))
                            Object.keys(dta.churnBubble.catesRegion).length >8 ? $('#bubleChurn').attr('style','height: 420px'): $('#bubleChurn').attr('style','height: 320px')
                            var chartRegionMonth = new google.visualization.BubbleChart(document.getElementById('bubleChurn'))
                            google.visualization.events.addListener(chartRegionMonth, 'ready', function () {
                                Array.prototype.forEach.call(document.getElementById('bubleChurn').getElementsByTagName('text'), function(text) {
                                    if ((text.getAttribute('text-anchor') === 'end') && (text.getAttribute('fill') === '#444444')) {
                                        if(text.innerHTML == 0 || text.innerHTML == undefined || text.innerHTML == Object.keys(dta.churnBubble.catesRegion).length+1)
                                            text.setAttribute('fill-opacity',0)
                                        else{
                                            text.innerHTML = keyByValue(dta.churnBubble.catesRegion, Number(text.innerHTML))
                                        }
                                    }
                                    // change label month
                                    if ((text.getAttribute('text-anchor') === 'middle') && (text.getAttribute('fill') === '#1c2752')) {
                                        if(Object.keys(dta.churnBubble.catesMonth).length == 1){
                                            if (text.innerHTML == 0.5 || text.innerHTML == 0.0 || text.innerHTML == 1.5)
                                                text.setAttribute('fill-opacity', 0)
                                            else {
                                                if(text.innerHTML == 1.0){
                                                    text.innerHTML = keyByValue(dta.churnBubble.catesMonth, 1)
                                                }
                                            }
                                        }
                                        else{
                                            if(text.innerHTML == 0 || text.innerHTML >= Object.keys(dta.churnBubble.catesMonth).length+1)
                                                text.setAttribute('fill-opacity',0)
                                            else{
                                                text.innerHTML = keyByValue(dta.churnBubble.catesMonth, Number(text.innerHTML))
                                            }
                                        }
                                    }
                                });
                                // remove circle value =0
                                Array.prototype.forEach.call(document.getElementById('bubleChurn').getElementsByTagName('circle'), function(circle) {
                                    if(circle.getAttribute('r') == 5 && Number(dta.churnBubble.isNull) == 1)
                                        circle.setAttribute('r', 1)
                                })
                            })
                            var dataRegionMonth = google.visualization.arrayToDataTable(getDataChurn(dta.churnBubble.data,  "Month", "Location"))
                            if(Object.keys(dta.churnBubble.catesMonth).length == 1)
                                optionsRegion.hAxis.gridlines.count = 4
                            else
                                optionsRegion.hAxis.gridlines.count = Object.keys(dta.churnBubble.catesMonth).length+2
                            optionsRegion.vAxis.gridlines.count = Object.keys(dta.churnBubble.catesRegion).length+2
                            optionsRegion.chartArea.left =170;
                            chartRegionMonth.draw(dataRegionMonth, optionsRegion)
                            google.visualization.events.addListener(chartRegionMonth, 'onmouseover', function (event) {
                                var rate = dataRegionMonth.getValue(event.row, 3);
                                var xAxis = dataRegionMonth.getValue(event.row, 1);
                                var yAxis = dataRegionMonth.getValue(event.row, 2);
                                var percent = dataRegionMonth.getValue(event.row, 4);
                                var contracts = dataRegionMonth.getValue(event.row, 5);
                                var x = mouseX - 225;
                                if($(window).width() < 992){
                                    mouseY = mouseY - 870
                                }
                                else{
                                    mouseY = mouseY -600
                                }
                                var y = mouseY
                                if(!(Number(percent == 0) && Number(rate) == 0)){
                                    $('#bubleChurn_tooltip').html('<div><p><b>Month:</b> ' + keyByValue(dta.churnBubble.catesMonth, xAxis) +'</p><p><b>Location:</b> '+ keyByValue( dta.churnBubble.catesRegion, yAxis) +
                                            '</p><p><b>Rate:</b> '+ rate +' %</p><p><b>Percent:</b> '+ percent +' %</p><p><b>Number of contracts: </b>'+contracts+'</p></div>').css({
                                        'top': y,
                                        'left': x
                                    }).fadeIn('slow');
                                }
                                // remove circle value =0
                                Array.prototype.forEach.call(document.getElementById('bubleChurn').getElementsByTagName('circle'), function(circle) {
                                    if(Number(dta.churnBubble.isNull) == 1 && (circle.getAttribute('fill') == 'none' || circle.getAttribute('r') == 5)){
                                        circle.setAttribute('r', 1)
                                    }
                                })
                            })
                            google.visualization.events.addListener(chartRegionMonth, 'onmouseout', handlerOut)

                            $('.counter').counterUp({
                                delay: 10,
                                time: 500
                            });

                            // update chart: Number of Contracts By Status
                            track1.xAxis[0].update({categories: dta.numofMonth.cates})
                            updateChartOverview(track1, getJsonChurnSeries(dta.numofMonth, 0))

                            // udpate chart:Churn Rate and Percent By Status
                            track2.xAxis[0].update({categories: dta.trendRatePert.totalTrend.cates})
                            track2.yAxis[1].update({
                                max: Number(dta.trendRatePert.totalTrend.maxPercent)
                            })
                            updateChartOverview(track2, getJsonChurnSeries(dta.trendRatePert.totalTrend, 1))
                        }
                        else{
                            alert("Error when execute query. Please check again your system!")
                        }
                    },
                    complete: function () {
                        $('.divLeft').waitMe("hide");
                    }
                });
            }

            // click apply fitler
            $('.apply').click(function () {
                getAjaxChurn()
            });
            $('.radio').on('ifChecked', function(){
                $('#combo').val($(this).val())
            });
            // click comment insert
            $('.btnCmt').click(function () {
                var fields = {
                    "csrfToken": document.querySelector('input[name=csrfToken]').value,
                    "comment"  : $(this).parent().parent().find('.comment').val(),
                    "chartId"  : $(this).attr("name")
                }
                insertComment(fields)
            });
        }

    function getJsonChurnSeries(data, _type){
        // _type: 0 -> 2 series
        // _type : 1 -> combo chart col and line
        var rs = []
        if(_type == 0){
            if($('#status').val() == "1"){
                rs.push({
                            name: data.titSeries1,
                            data: data.huydv
                        })
            }
            else if($('#status').val() == "3"){
                rs.push(
                        {
                            name: data.titSeries2,
                            data: data.ctbdv
                        })
            }
            else{
                rs.push({
                            name: data.titSeries1,
                            data: data.huydv
                        },
                        {
                            name: data.titSeries2,
                            data: data.ctbdv
                        })
            }
        }
        else{
            rs.push({
                    name: "Churn Rate(%)",
                    type: 'column',
                    yAxis: 0,
                    data: data.rate
                },
                {
                    name: "Churn Percent(%)",
                    type: 'column',
                    yAxis: 1,
                    data: data.perct
                },
                {
                    name: "F1",
                    type: 'spline',
                    yAxis: 0,
                    data: data.f1
                })
        }

        return rs
    }

    function updateChartOverview(charts, data){
        var seriesLength = charts.series.length;
        for(var i = seriesLength -1; i > -1; i--) {
            charts.series[i].remove();
        }
        for(var i=0; i< data.length; i++) {
            charts.addSeries(data[i]);
        }
    }

    function getParamFields(token){
        var boxes = $('.statusDiv .checkbox:checked');
        var status = ""
        boxes.each(function(i, chkbox) {
            status += chkbox.value
        });
        $('#status').val(status)
        var obj = {
            "csrfToken" : token,
            "province"  : $('#province').val() == "All" ? "": $('#province').val(),
            "combo"  : $('#combo').val(),
            "age"    : $('.ageDiv .select2-selection__choice').text().substring(1,$('.ageDiv .select2-selection__choice').text().length).split('x').join(','),
            "package": $('.packageDiv .select2-selection__choice').text().substring(1,$('.packageDiv .select2-selection__choice').text().length).split('x').join(','),
            "month"  : $('.monthGrp').val(),
            "status" : status
        }
        //console.log(obj)
        return obj
    }

    function getJsonTreeListRegion(dta, arrKey){
        /*[
               { "id" : "ajson1", "parent" : "#", "text" : "Simple root node" },
               { "id" : "ajson2", "parent" : "#", "text" : "Root node 2" },
               { "id" : "ajson3", "parent" : "ajson2", "text" : "Child 1" },
               { "id" : "ajson4", "parent" : "ajson2", "text" : "Child 2" },
                ]*/
        var jsArray = []
        jsArray.push({
            "text": "Choose Region",
            "id": "All",
            "parent": "#",
            'state' : {
                'opened' : false,
                'selected' : true
            }
        })
        for(var key=0;key<arrKey.length;key++){
            jsArray.push({
                "text": "Region "+arrKey[key],
                "id": arrKey[key],
                "parent": "All"
            })
            for(var i=0;i<dta.length;i++){
                if(arrKey[key] == dta[i][0]){
                    jsArray.push({
                        "text": dta[i][1],
                        "id": dta[i][1],
                        "parent": arrKey[key]
                    })
                }
            }
        }
        return jsArray
    }

    function getDataChurn(dta, cateX, cateY){
        var rs = []
        rs.push(['ID', cateX, cateY,'Rate', 'Percent', 'Contract'])
        for(var i=0;i<dta.length;i++){
            var arr = []
            arr[0]=''
            arr[1]=dta[i][1]
            arr[2]=dta[i][0]
            arr[3]=dta[i][2]
            arr[4]=dta[i][3]
            arr[5]=dta[i][4]
            rs.push(arr)
        }
        return rs
    }
</script>