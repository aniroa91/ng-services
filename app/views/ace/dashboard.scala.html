@(response: model.DashboardResponse)
@import services.domain.CommonService.formatNumber
@import services.domain.CommonService.percent
@import play.api.libs.json.Json
@import services.domain.CommonService.getLinkTag


@top(".", "Dashboard", 0)

<div class="page-header">
	<h1>
		Dashboard
		<small>
			<i class="ace-icon fa fa-angle-double-right"></i>
			@response.report.day
		</small>
	</h1>
</div>

<div class="row">
	<div class="col-xs-12">
		<!-- PAGE CONTENT BEGINS -->
		<div class="alert alert-block alert-success">
			<button type="button" class="close" data-dismiss="alert">
				<i class="ace-icon fa fa-times"></i>
			</button>
			<i class="ace-icon fa fa-check green"></i>
			Statistics for
			<strong class="green">
				@response.report.day
				<!--
				<small>(v1.4)</small>
				-->
			</strong>
		</div>
		<div class="row">
			<!--
			<div class="row">
				<div class="col-sm-1"></div>
				<div class="col-sm-2">
					@@total(response.report.current, response.report.previous)
				</div>
				<div class="col-sm-1"></div>
				<div class="col-sm-7">
					@@classify(response.report.current, response.report.labels)
				</div>
			</div><!-- /.col -->

			<div id="bubble-chart-3d"></div>

		</div><!-- /.col -->

		<div class="hr hr32 hr-dotted"></div>
		<div class="row">
			<div class="col-sm-4">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-small">
						<h4 class="widget-title blue smaller">
							<i class="ace-icon fa fa-bar-chart orange"></i>
							Top 10 Malwares
						</h4>
						<div class="widget-toolbar">
							<a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
						</div>
					</div>
					<div class="widget-body" style="display: block;">
						<div class="widget-main no-padding">
							<div id="top-10-malwares"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-small">
						<h4 class="widget-title blue smaller">
							<i class="ace-icon fa fa-bar-chart orange"></i>
							Top 10 Main Domain Black
						</h4>
						<div class="widget-toolbar">
							<a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
						</div>
					</div>
					<div class="widget-body" style="display: block;">
						<div class="widget-main no-padding">
							<div id="top-10-domain-black"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-4">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-small">
						<h4 class="widget-title blue smaller">
							<i class="ace-icon fa fa-bar-chart orange"></i>
							Top 10 Main Domain
						</h4>
						<div class="widget-toolbar">
							<a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
						</div>
					</div>
					<div class="widget-body" style="display: block;">
						<div class="widget-main no-padding">
							<div id="top-10-main-domain"></div>
						</div>
					</div>
				</div>
			</div>
		</div><!-- /.row -->
		<div class="hr hr32 hr-dotted"></div>
		<div class="row">
			<div class="col-sm-12">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-small">
						<h4 class="widget-title blue smaller">
							<i class="ace-icon fa fa-line-chart green"></i>
							Daily Report
						</h4>
						<div class="widget-toolbar">
							<a href="#" data-action="collapse"><i class="ace-icon fa fa-chevron-up"></i></a>
						</div>
					</div>
					<div class="widget-body" style="display: block;">
						<div class="widget-main no-padding">
							<div id="daily-line-chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
						</div>
					</div>
				</div>
			</div>
		</div><!-- /.row -->
	</div><!-- /.col -->
</div><!-- /.row -->


@scripts = {
<script type="text/javascript">
	$(function () {
	    var categories = @Html(Json.stringify(Json.toJson(response.daily.map(x => x._1))));
	    var queries = @Html(Json.stringify(Json.toJson(response.daily.map(x => x._2.queries))));
	    var domains = @Html(Json.stringify(Json.toJson(response.daily.map(x => x._2.domains))));
	    var clients = @Html(Json.stringify(Json.toJson(response.daily.map(x => x._2.clients))));

	    Highcharts.chart('daily-line-chart', {
	        chart: {
	            type: 'line',
	            zoomType: 'xy'
	        },
	        title: {
	            text: 'Daily Query'
	        },
	        subtitle: {
	            text: 'Source: DNS LOG FTEL'
	        },
	        plotOptions: {
	        line: {
	            dataLabels: {
	                enabled: true
	            },
	                enableMouseTracking: false
	            }
	        },
	        xAxis: [{
	            categories: categories,
	            crosshair: true
	        }],
	        yAxis: [{ // Primary yAxis
	            labels: {
	                format: '{value}',
	                style: {
	                    color: Highcharts.getOptions().colors[2]
	                }
	            },
	            title: {
	                text: 'Clients',
	                style: {
	                    color: Highcharts.getOptions().colors[2]
	                }
	            },
	            opposite: true

	        }, { // Secondary yAxis
	            gridLineWidth: 0,
	            title: {
	                text: 'Queries',
	                style: {
	                    color: Highcharts.getOptions().colors[0]
	                }
	            },
	            labels: {
	                format: '{value}',
	                style: {
	                    color: Highcharts.getOptions().colors[0]
	                }
	            }

	        }, { // Tertiary yAxis
	            gridLineWidth: 0,
	            title: {
	                text: 'Domains',
	                style: {
	                    color: Highcharts.getOptions().colors[1]
	                }
	            },
	            labels: {
	                format: '{value}',
	                style: {
	                    color: Highcharts.getOptions().colors[1]
	                }
	            },
	            opposite: true
	        }],
	        tooltip: {
	            shared: true
	        },
	        legend: {
	            layout: 'vertical',
	            align: 'left',
	            x: 80,
	            verticalAlign: 'top',
	            y: 55,
	            floating: true,
	            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
	        },
	        series: [{
	            name: 'Queries',
	            type: 'spline',
	            yAxis: 1,
	            data: queries,
	            tooltip: {
	                valueSuffix: ''
	            }

	        }, {
	            name: 'Domains',
	            type: 'spline',
	            yAxis: 2,
	            data: domains,
	            marker: {
	                enabled: false
	            },
	            dashStyle: 'shortdot',
	            tooltip: {
	                valueSuffix: ''
	            }

	        }, {
	            name: 'Clients',
	            type: 'spline',
	            data: clients,
	            tooltip: {
	                valueSuffix: ''
	            }
	        }]
	    });

	    categories = @Html(Json.stringify(Json.toJson(response.report.malwares.take(10).map(x => x.malware))));
	    queries = @Html(Json.stringify(Json.toJson(response.report.malwares.take(10).map(x => x.queries))));
	    domains = @Html(Json.stringify(Json.toJson(response.report.malwares.take(10).map(x => x.domains))));
	    var title = "Top 10 Malwares"


	    Highcharts.chart('top-10-malwares', {
	        chart: {
	            type: 'bar',
	            height: '600px'
	        },
	        title: {
	            text: "Top 10 Malwares"
	        },
	        plotOptions: {
	        bar: {
	            	dataLabels: {
	                	enabled: true
	            	}
	        	}
	    	},
	        xAxis: {
	            categories: categories
	        },

	        yAxis: {
	            title: {
	                text: "Queries/Domains"
	            }
	        },
	        series: [
	        {
	            name: "Queries",
	            data: queries
	        }, {
	            name: "Domains",
	            data: domains
	        }]
	    });

	    categories = @Html(Json.stringify(Json.toJson(response.report.blacks.take(10).map(x => getLinkTag(x.name) + " [" + x.malware + "]"))));
	    queries = @Html(Json.stringify(Json.toJson(response.report.blacks.take(10).map(x => x.queries))));
	    clients = @Html(Json.stringify(Json.toJson(response.report.blacks.take(10).map(x => x.clients))));
	    var title = "Top 10 Malwares"


	    Highcharts.chart('top-10-domain-black', {
	        chart: {
	            type: 'bar',
	            height: '600px'
	        },
	        title: {
	            text: "Top 10 Domain Black"
	        },
	        plotOptions: {
	        bar: {
	            	dataLabels: {
	                	enabled: true
	            	}
	        	}
	    	},
	        xAxis: {
	            categories: categories
	        },

	        yAxis: {
	            title: {
	                text: "Queries/Clients"
	            }
	        },
	        series: [
	        {
	            name: "Queries",
	            data: queries
	        }, {
	            name: "Clients",
	            data: clients
	        }]
	    });

	    categories = @Html(Json.stringify(Json.toJson(response.report.seconds.take(10).map(x => x.name))));
	    queries = @Html(Json.stringify(Json.toJson(response.report.seconds.take(10).map(x => x.queries))));
	    clients = @Html(Json.stringify(Json.toJson(response.report.seconds.take(10).map(x => x.clients))));
	    var title = "Top 10 Main Domain"


	    Highcharts.chart('top-10-main-domain', {
	        chart: {
	            type: 'bar',
	            height: '600px'
	        },
	        title: {
	            text: "Top 10 Main Domain"
	        },
	        plotOptions: {
	        bar: {
	            	dataLabels: {
	                	enabled: true
	            	}
	        	}
	    	},
	        xAxis: {
	            categories: categories
	        },

	        yAxis: {
	            title: {
	                text: "Queries/Clients"
	            }
	        },
	        series: [
	        {
	            name: "Queries",
	            data: queries
	        }, {
	            name: "Clients",
	            data: clients
	        }]
	    });

	    var data1 = @Html(Json.stringify(response.toBubbleBlack));
	    var data2 = @Html(Json.stringify(response.toBubbleWhite));
	    var data3 = @Html(Json.stringify(response.toBubbleUnknow));
	    Highcharts.chart('bubble-chart-3d', {

		    chart: {
		        type: 'bubble',
		        plotBorderWidth: 1,
		        zoomType: 'xy'
		    },

		    title: {
		        text: 'Highcharts bubbles with radial gradient fill'
		    },

		    xAxis: {
		        gridLineWidth: 1,
		        title: {
            		text: 'Queries'
        		}
		    },

		    yAxis: {
		        startOnTick: false,
		        endOnTick: false,
		        title: {
            		text: 'Clients'
        		}
		    },

		     tooltip: {
		        useHTML: true,
		        headerFormat: '<table>',
		        pointFormat: 
		        	'<tr><th colspan="2"><h3>{point.name}</h3></th></tr>' +
		            '<tr><th>Queries:</th><td>{point.x}</td></tr>' +
		            '<tr><th>Client:</th><td>{point.y}</td></tr>' +
		            '<tr><th>QpC:</th><td>{point.z}</td></tr>',
		        footerFormat: '</table>',
		        followPointer: true
		    },

		    series: [{
		        data: data1,
		        name: "Black",
		        marker: {
		            fillColor: {
		                radialGradient: { cx: 0.4, cy: 0.3, r: 0.7 },
		                stops: [
		                    [0, 'rgba(255,255,255,0.5)'],
		                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0.5).get('rgba')]
		                ]
		            }
		        }
		    }, {
		        data: data2,
		        name: "White",
		        marker: {
		            fillColor: {
		                radialGradient: { cx: 0.4, cy: 0.3, r: 0.7 },
		                stops: [
		                    [0, 'rgba(255,255,255,0.5)'],
		                    [1, Highcharts.Color(Highcharts.getOptions().colors[1]).setOpacity(0.5).get('rgba')]
		                ]
		            }
		        }
		    }, {
		        data: data3,
		        name: "Unknow",
		        marker: {
		            fillColor: {
		                radialGradient: { cx: 0.4, cy: 0.3, r: 0.7 },
		                stops: [
		                    [0, 'rgba(255,255,255,0.5)'],
		                    [1, Highcharts.Color(Highcharts.getOptions().colors[2]).setOpacity(0.5).get('rgba')]
		                ]
		            }
		        }
		    }
/*
		    ,
		     {
		        data: [
		            [42, 38, 20],
		            [6, 18, 1],
		            [1, 93, 55],
		            [57, 2, 90],
		            [80, 76, 22],
		            [11, 74, 96],
		            [88, 56, 10],
		            [30, 47, 49],
		            [57, 62, 98],
		            [4, 16, 16],
		            [46, 10, 11],
		            [22, 87, 89],
		            [57, 91, 82],
		            [45, 15, 98]
		        ],
		        marker: {
		            fillColor: {
		                radialGradient: { cx: 0.4, cy: 0.3, r: 0.7 },
		                stops: [
		                    [0, 'rgba(255,255,255,0.5)'],
		                    [1, Highcharts.Color(Highcharts.getOptions().colors[1]).setOpacity(0.5).get('rgba')]
		                ]
		            }
		        }
		    }*/
		    ]

		});
	});
</script>
}

@bottom(".", "index", scripts)

